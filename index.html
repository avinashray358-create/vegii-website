<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vegii — The Vegetable Company</title>
  <style>
    /* ... yahi tumhara existing CSS ... */
  </style>
</head>
<body>
  <!-- Header, Hero, Controls same jaise pehle ... -->

  <!-- Products Grid -->
  <main id="products" class="grid" aria-live="polite">
    <!-- JS will populate product cards here -->
  </main>

  <!-- Footer / Contact same jaise pehle ... -->

  <script>
    // Backend URL
    const BACKEND_URL = "https://vegii-backend.onrender.com";

    // Simple cart (in-memory)
    const cart = {};

    // Utilities
    function el(tag, attrs={}, children=""){
      const e = document.createElement(tag);
      for(const k in attrs){
        if(k==="class") e.className = attrs[k];
        else if(k==="html") e.innerHTML = attrs[k];
        else e.setAttribute(k, attrs[k]);
      }
      if(children) e.append(children);
      return e;
    }

    // Render products
    const grid = document.getElementById('products');
    let products = [];

    async function loadProducts() {
      try {
        const res = await fetch(`${BACKEND_URL}/api/products`);
        products = await res.json();
        applyFilters();
      } catch(e) {
        console.error("Error fetching products:", e);
        grid.innerHTML = `<div class="card"><h3>Error loading products</h3><p class="small">Try refreshing the page.</p></div>`;
      }
    }

    function renderList(list){
      grid.innerHTML = "";
      if(list.length===0){
        const empty = el('div',{class:"card", html:`<h3>No items found</h3><p class="small">Try different search or category.</p>`});
        grid.appendChild(empty); return;
      }
      list.forEach(p => {
        const card = el('div',{class:"card"});
        const top = el('div',{style:"display:flex;align-items:center;gap:12px"});
        const e = el('div',{class:"veg-emoji"}, p.emoji);
        top.appendChild(e);
        const meta = el('div');
        meta.appendChild(el('h3',{html:p.name}));
        meta.appendChild(el('p',{class:"small", html: p.desc || "" }));
        top.appendChild(meta);
        card.appendChild(top);

        const bottom = el('div',{style:"display:flex;align-items:center;justify-content:space-between;gap:8px;margin-top:8px"});
        bottom.appendChild(el('div',{html:`<div class="price">₹${p.price} / ${p.unit}</div><div class="small">Estimated fresh weight</div>`}));
        const actions = el('div',{class:"actions"});
        const addBtn = el('button',{class:"primary", type:"button"}, "Add");
        addBtn.onclick = ()=> { addToCart(p.id); };
        const info = el('a',{class:"outline", href:"#", onclick:"return false"}, "Details");
        actions.appendChild(addBtn); actions.appendChild(info);
        bottom.appendChild(actions);
        card.appendChild(bottom);
        grid.appendChild(card);
      });
    }

    // Search + filter + sort
    const searchInput = document.getElementById('search');
    const catSelect = document.getElementById('category');
    const sortSelect = document.getElementById('sort');

    function applyFilters(){
      const q = searchInput.value.trim().toLowerCase();
      const cat = catSelect.value;
      const sort = sortSelect.value;
      let filtered = products.filter(p => {
        const matchQ = q === "" || p.name.toLowerCase().includes(q) || (p.desc || "").toLowerCase().includes(q);
        const matchCat = cat === "" || p.cat === cat;
        return matchQ && matchCat;
      });
      if(sort === "price-asc") filtered.sort((a,b)=>a.price-b.price);
      if(sort === "price-desc") filtered.sort((a,b)=>b.price-a.price);
      renderList(filtered);
    }

    searchInput.addEventListener('input', applyFilters);
    catSelect.addEventListener('change', applyFilters);
    sortSelect.addEventListener('change', applyFilters);

    // Cart behavior
    function addToCart(id){
      cart[id] = (cart[id] || 0) + 1;
      updateCartBadge();
      const p = products.find(x=>x.id===id);
      alert(p.name + " added to cart");
    }
    function updateCartBadge(){
      const c = Object.values(cart).reduce((s,n)=>s+n,0);
      const b = document.getElementById('cartCount');
      if(c>0){ b.style.display="inline-block"; b.textContent = c; } else { b.style.display="none"; }
    }

    // Send message to backend
    async function fakeSend(){
      const n = document.getElementById('name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const msg = document.getElementById('msg').value.trim();

      if(!n || !msg){ alert("Name aur message daal do"); return; }

      try {
        const res = await fetch(`${BACKEND_URL}/api/messages`, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({name: n, phone, msg})
        });

        if(res.ok){
          document.getElementById('sentToast').style.display = 'block';
          document.getElementById('name').value = '';
          document.getElementById('phone').value = '';
          document.getElementById('msg').value = '';
        } else {
          alert("Error sending message, try again later!");
        }
      } catch(e) {
        alert("Error connecting to backend!");
        console.error(e);
      }
    }

    // Initial render
    document.getElementById('year').textContent = new Date().getFullYear();
    loadProducts();
    updateCartBadge();

    document.addEventListener('keydown', (e) => {
      if(e.key === "/" && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA'){
        e.preventDefault();
        searchInput.focus();
      }
    });
  </script>
</body>
</html>
